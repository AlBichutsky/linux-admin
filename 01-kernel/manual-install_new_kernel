# занятие 1.Сборка ядра Linux с сайта kernel.org
# Домашняя работа *

# Делаем собственную сборку ядра
# Взять любую версию ядра с kernel.org
# Подложить файл конфигурации ядра
# Собрать ядро (попутно доставляя необходимые пакеты)
# Прислать результирующий файл конфигурации
# Прислать списк доустановленных пакетов, взять его можно из /var/log/yum.log
# Устанавливать будем на следующем занятии =)
# Критерии оценки: - Ядро собрано
#- Прислан результирующий файл конфигурации
#- Прислан списк доустановленных пакетов

# Устанавливаем пакеты, необходимые для компиляции ядра linux
yum install -y ncurses-devel make gcc bc bison flex elfutils-libelf-devel openssl-devel

# Устаналиваем утилиту wget
yum install -y wget

# Создаем каталог newkernel в /usr/src 
cd /usr/src/
mkdir newkernel
chmod 777 newkernel

# Скачиваем архив со стабильной версией ядра 4.20.5 с kernel.org в созданный каталог
cd newkernel
wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.20.5.tar.xz

# Распаковываем архив
tar -xvf linux-4.20.5.tar.xz

# Копируем старую конфигурацию ядра .config из каталога /boot в каталог /usr/src/newkernel/linux-4.20.5/
cd linux-4.20.5/
cp -v /boot/config-3.10.0-957.1.3.el7.x86_64 /usr/src/newkernel/linux-4.20.5/.config

# Cоздаем новую конфигурацию ядра на основе скопированного ранее файла .config.
# Если в новом ядре были добавлены новые функции, то будут заданы вопросы по настройке новых параметров.
# Указываем автоматический ответ на вопросы.
sudo sh -c 'yes "" | make oldconfig'

# Запускаем компиляцию нового ядра (ждем продолжительно время)
sudo make

# После завершения компиляции установим новое ядро + все модули
sudo make modules_install install

# Перегружаем машину. 
reboot

# На стадии загрузки выбираем новое ядро 4.20.5.
# После загрузки в консоли проверяем версию ядра 
uname -a
