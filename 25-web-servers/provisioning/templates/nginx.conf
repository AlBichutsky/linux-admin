
events {
    worker_connections 1024;
}

http {
    server {
        listen       80 default_server;
        server_name  default_server;
        root         /usr/share/nginx/html;

        location / {
                
                # В этом локейшене находится web-страница index.html
                # Чтобы получить к ней доступ требуется секретная кука

                # Если куки нет или она не соответствует установленному значению, 
                if ($cookie_access != "SecretCookie") { 
                # то осуществляется перенаправление по коду 302 в локейшн /GetCookie
                  return 302 $scheme://$server_addr/GetCookie;     
                }
        }
        
        location /GetCookie {
                # При переходе в локейшн /GetCookie добавляется необходимая кука   
                add_header Set-Cookie "access=SecretCookie"; 
                # Затем осуществляется обратное перенаправление по коду 302 в локейшн /     
                return 302 $scheme://$server_addr/;                       
        
        }

    }
}
